
@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
}
@{
    Layout = "_Layout";
    ViewData["Title"] = "Participant";
}
@model FromationForMedia

<div class="course-wrapper">
    <div class="sidebar">
        <div class="course-header">
            <span class="course-icon">📱</span>
            <span class="course-title">@Model.Titre</span>
            <span class="toggle-icon">❯</span>
        </div>

        <div class="lesson-list">
            @{
                var weeksGrouped = Model.Media.GroupBy(m => (m.nombredesequence - 1) / 7 + 1);
            }

            @foreach (var week in weeksGrouped)
            {
                <div class="week-section">
                    <h3>Week @week.Key</h3>
                    @foreach (var media in week)
                    {
                        <div class="lesson-item @(media.Id == Model.Media.First().Id ? "active" : "")"
                             data-media-id="@media.Id">
                            <a href="javascript:playVideo('@media.Url', @media.Id)">
                                <span class="lesson-status"></span>
                                <span class="lesson-name">@media.Title</span>
                            </a>
                        </div>
                    }
                </div>
            }
        </div>
    </div>

    <div class="main-content">
        <div class="navigation-breadcrumb">
            @Model.Titre > @Model.Media.First().Title
        </div>

        <h1>@Model.Media.First().Title</h1>

        <div class="video-container">
            <video id="videoPlayer" controls>
                <source src="@Model.Media.First().Url" type="video/mp4">
            </video>
        </div>

        <div class="navigation-buttons">
            <a href="#" class="back-button">Back to Course</a>
            <a href="#" class="next-button" onclick="playNextLesson()">Next Lesson ❯</a>
        </div>
    </div>
</div>

<style>
    .course-wrapper {
        margin-top:6rem;
        display: flex;
        min-height: 100vh;
    }

    .sidebar {
        width: 300px;
        background: white;
        border-right: 1px solid #e0e0e0;
    }

    .course-header {
        background: #008BB7;
        color: white;
        padding: 15px;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .course-title {
        flex: 1;
        font-weight: 500;
    }

    .lesson-list {
        padding: 20px 0;
    }

    .week-section h3 {
        color: #666;
        padding: 10px 20px;
        margin: 0;
        font-size: 14px;
    }

    .lesson-item {
        padding: 10px 20px;
        border-left: 3px solid transparent;
    }

        .lesson-item.active {
            border-left-color: #008BB7;
            background: #f5f9fa;
        }

        .lesson-item a {
            display: flex;
            align-items: center;
            gap: 10px;
            color: #333;
            text-decoration: none;
        }

    .lesson-status {
        width: 12px;
        height: 12px;
        border: 2px solid #ddd;
        border-radius: 50%;
    }

    .active .lesson-status {
        background: #008BB7;
        border-color: #008BB7;
    }

    .main-content {
        flex: 1;
        padding: 20px 40px;
    }

    .navigation-breadcrumb {
        color: #666;
        margin-bottom: 20px;
    }

    .video-container {
        position: relative;
        padding-bottom: 56.25%;
        height: 0;
        overflow: hidden;
    }

        .video-container video {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

    .navigation-buttons {
        display: flex;
        justify-content: space-between;
        margin-top: 20px;
    }

    .back-button, .next-button {
        padding: 10px 20px;
        text-decoration: none;
    }

    .next-button {
        background: #008BB7;
        color: white;
        border-radius: 4px;
    }
</style>

<script>
    function playVideo(url, mediaId) {
        const video = document.getElementById('videoPlayer');
        video.src = url;
        video.play();

        document.querySelectorAll('.lesson-item').forEach(item => {
            item.classList.remove('active');
        });
        document.querySelector(`[data-media-id="${mediaId}"]`).classList.add('active');
    }

    function playNextLesson() {
        const currentLesson = document.querySelector('.lesson-item.active');
        const nextLesson = currentLesson.nextElementSibling;
        if (nextLesson) {
            const mediaId = nextLesson.dataset.mediaId;
            const videoUrl = nextLesson.querySelector('a').getAttribute('href').split("'")[1];
            playVideo(videoUrl, mediaId);
        }
    }
</script>